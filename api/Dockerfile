FROM python:3.10

RUN mkdir -p /app
WORKDIR /app

COPY requirements.txt /app/requirements.txt
RUN python3 -m pip install -r /app/requirements.txt

ARG AZURE_SUBSCRIPTION_ID
ARG AZURE_RESOURCE_GROUP
ARG AZURE_LOCATION
ARG AZURE_NAME
ARG AZURE_TENANT_ID
ARG AZURE_CLIENT_ID
ARG AZURE_CLIENT_SECRET
ARG IBMQ_CLIENT_SECRET

ENV AZURE_SUBSCRIPTION_ID=${AZURE_SUBSCRIPTION_ID}
ENV AZURE_RESOURCE_GROUP=${AZURE_RESOURCE_GROUP}
ENV AZURE_LOCATION=${AZURE_LOCATION}
ENV AZURE_NAME=${AZURE_NAME}
ENV AZURE_TENANT_ID=${AZURE_TENANT_ID}
ENV AZURE_CLIENT_ID=${AZURE_CLIENT_ID}
ENV AZURE_CLIENT_SECRET=${AZURE_CLIENT_SECRET}
ENV IBMQ_CLIENT_SECRET=${IBMQ_CLIENT_SECRET}

COPY ./qupo_backend ./qupo_backend
RUN ls -la

EXPOSE 8000

CMD ["uvicorn", "qupo_backend.main:app", "--host=0.0.0.0" , "--reload" , "--port", "8000"]